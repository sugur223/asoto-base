# イベント・ポイント・ダッシュボード機能 - 詳細設計

このドキュメントでは、残り3つの主要機能をまとめて説明します。

---

# Part 1: イベント管理機能

## 1. 機能概要

コミュニティ内のイベント（読書会、勉強会、交流会など）を作成・管理し、参加を促進する機能。Discordでのやり取りが複雑だった課題を解決し、イベント情報を一元管理する。

## 2. ユーザーストーリー

### イベント主催者（佐藤さん）のケース

**背景**
- 毎月読書会を主催している
- これまでDiscordで告知していたが、情報が流れてしまう

**ストーリー**
1. 「+ イベント作成」ボタンをクリック
2. イベント情報を入力：
   - タイトル：「11月の読書会」
   - 日時：2025-11-20 19:00-21:00
   - 場所：オンライン（Zoomリンク）
   - 定員：10人
   - タグ：#読書会 #オンライン
3. 「参加者におすすめする人」機能で、関連する興味を持つ人に自動通知
4. イベント公開 → 参加者が集まる
5. イベント当日、参加者リストとZoomリンクを確認
6. イベント後、参加者に「振り返りログを書きませんか？」と促進

### イベント参加者（田中さん）のケース

**背景**
- 読書会に興味がある
- どんなイベントがあるか探している

**ストーリー**
1. ダッシュボードに「おすすめイベント」が表示
2. 「11月の読書会 - マッチ度88%」を発見
3. イベント詳細を確認
4. 「参加する」ボタンをクリック
5. カレンダーに自動追加（オプション）
6. 前日にリマインダー通知が届く
7. 当日参加 → 10ポイント獲得
8. イベント後、振り返りログを記録 → 5ポイント獲得

## 3. 画面設計

### 3.1 イベント一覧画面（/events）

```
┌─────────────────────────────────────────────────────────┐
│  イベント                                      [+ 作成]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📅 カレンダー表示  📝 リスト表示  🔍 検索             │
│                                                         │
│  フィルター: [今後] [過去] [参加済み]                    │
│  タグ: [すべて ▼] [#読書会] [#勉強会] [#交流会]         │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 📚 11月の読書会                              │        │
│  │                                              │        │
│  │ 📅 2025-11-20 (水) 19:00-21:00              │        │
│  │ 📍 オンライン (Zoom)                         │        │
│  │ 👥 7/10人 参加予定                           │        │
│  │ 🏷️ #読書会 #オンライン                       │        │
│  │                                              │        │
│  │ 主催: 佐藤さん                               │        │
│  │                                              │        │
│  │ 今月のテーマは「人生を変えた一冊」。        │        │
│  │ 自分の推し本を持ち寄って議論しましょう！    │        │
│  │                                              │        │
│  │ 💡 あなたにおすすめ（マッチ度: 88%）        │        │
│  │                                              │        │
│  │ [詳細を見る] [参加する]                      │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 💻 デザイン思考ワークショップ                │        │
│  │                                              │        │
│  │ 📅 2025-11-22 (金) 19:30-22:00              │        │
│  │ 📍 渋谷（詳細は参加者に通知）                │        │
│  │ 👥 15/20人 参加予定                          │        │
│  │ 🏷️ #デザイン #ワークショップ #オフライン     │        │
│  │                                              │        │
│  │ 主催: 山田さん                               │        │
│  │                                              │        │
│  │ デザイン思考の基礎を学び、実践します。      │        │
│  │ 初心者歓迎！                                │        │
│  │                                              │        │
│  │ [詳細を見る] [参加する]                      │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🎉 あそと新年会                              │        │
│  │                                              │        │
│  │ 📅 2025-12-28 (土) 18:00-21:00              │        │
│  │ 📍 新宿（詳細は参加者に通知）                │        │
│  │ 👥 5/30人 参加予定                           │        │
│  │ 🏷️ #交流会 #オフライン #懇親会               │        │
│  │                                              │        │
│  │ 主催: 鈴木さん                               │        │
│  │                                              │        │
│  │ [詳細を見る] [参加する]                      │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.2 イベント詳細画面（/events/:id）

```
┌─────────────────────────────────────────────────────────┐
│  ← 戻る                                        [編集]    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  📚 11月の読書会                                        │
│                                                         │
│  主催: 👤 佐藤太郎さん                                  │
│  🏷️ #読書会 #オンライン                                 │
│                                                         │
│  ─────────────────────────────────────────────        │
│                                                         │
│  📅 日時                                                │
│     2025-11-20 (水) 19:00 - 21:00                      │
│     [カレンダーに追加]                                  │
│                                                         │
│  📍 場所                                                │
│     オンライン                                          │
│     Zoomリンク: （参加者のみ表示）                      │
│                                                         │
│  👥 参加者（7/10人）                                    │
│     ┌──────────────────────────────────┐              │
│     │ 👤 田中さん  👤 鈴木さん  👤 山田さん │              │
│     │ 👤 高橋さん  👤 伊藤さん  👤 渡辺さん │              │
│     │ 👤 中村さん                          │              │
│     │                                      │              │
│     │ [+ あと3人参加可能]                  │              │
│     └──────────────────────────────────┘              │
│                                                         │
│  ─────────────────────────────────────────────        │
│                                                         │
│  📝 イベント説明                                        │
│                                                         │
│  今月のテーマは「人生を変えた一冊」です。              │
│                                                         │
│  自分の人生に影響を与えた本を持ち寄って、              │
│  なぜその本が重要だったのか、どんな気づきを            │
│  得たのかをシェアしましょう。                          │
│                                                         │
│  ＜タイムテーブル＞                                     │
│  19:00-19:10  チェックイン                             │
│  19:10-20:30  各自プレゼン & ディスカッション          │
│  20:30-21:00  フリートーク                             │
│                                                         │
│  初参加の方も大歓迎です！                              │
│                                                         │
│  ─────────────────────────────────────────────        │
│                                                         │
│  💬 コメント（3件）                                     │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 👤 田中  2025-11-15 10:30                   │        │
│  │                                              │        │
│  │ 楽しみにしています！『7つの習慣』を        │        │
│  │ 紹介する予定です。                          │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 👤 佐藤（主催者） 2025-11-15 11:00          │        │
│  │                                              │        │
│  │ ありがとうございます！楽しみですね✨        │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ コメントを追加...                            │        │
│  │                                              │        │
│  │ [投稿]                                       │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ─────────────────────────────────────────────        │
│                                                         │
│              [キャンセル]        [参加する]            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.3 イベント作成画面（/events/new）

```
┌─────────────────────────────────────────────────────────┐
│  イベントを作成                                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  イベントタイトル *                                     │
│  ┌────────────────────────────────────────────┐        │
│  │ 11月の読書会                                 │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  説明 *                                                 │
│  ┌────────────────────────────────────────────┐        │
│  │ 今月のテーマは「人生を変えた一冊」です。    │        │
│  │                                              │        │
│  │ 自分の人生に影響を与えた本を持ち寄って...   │        │
│  │                                              │        │
│  │                                              │        │
│  └────────────────────────────────────────────┘        │
│  Markdown対応  [太字] [リスト] [リンク]                │
│                                                         │
│  開催日時 *                                             │
│  ┌──────────────┐  ┌──────┐  〜  ┌──────┐          │
│  │ 2025-11-20   │  │19:00 │      │21:00 │          │
│  └──────────────┘  └──────┘      └──────┘          │
│                                                         │
│  開催形式 *                                             │
│  ◉ オンライン  ○ オフライン  ○ ハイブリッド           │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 📍 オンライン会議URL（任意）                 │        │
│  │ ┌──────────────────────────────────┐       │        │
│  │ │ https://zoom.us/j/xxxxx           │       │        │
│  │ └──────────────────────────────────┘       │        │
│  │                                              │        │
│  │ 💡 参加者のみに表示されます                  │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  定員                                                   │
│  ┌──────┐                                              │
│  │  10  │ 人                                           │
│  └──────┘                                              │
│  ☐ 定員なし                                            │
│                                                         │
│  参加条件                                               │
│  ◉ 誰でも参加可能                                      │
│  ○ 承認制（主催者が承認）                              │
│                                                         │
│  タグ（カンマ区切り）                                   │
│  ┌────────────────────────────────────────────┐        │
│  │ 読書会, オンライン, 交流                     │        │
│  └────────────────────────────────────────────┘        │
│  よく使われるタグ: #勉強会 #デザイン #プログラミング    │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🤖 AIが参加者におすすめする                  │        │
│  │                                              │        │
│  │ ☑ この興味に合う人に自動で通知する           │        │
│  │   → 推定: 約20人に通知されます               │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│                   [キャンセル]      [作成する]         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 4. データモデル

```python
from sqlalchemy import Column, String, DateTime, Integer, Boolean, Enum
from app.database import Base
import enum

class EventType(str, enum.Enum):
    ONLINE = "online"
    OFFLINE = "offline"
    HYBRID = "hybrid"

class EventStatus(str, enum.Enum):
    DRAFT = "draft"           # 下書き
    PUBLISHED = "published"   # 公開中
    ONGOING = "ongoing"       # 開催中
    COMPLETED = "completed"   # 終了
    CANCELLED = "cancelled"   # キャンセル

class Event(Base):
    __tablename__ = "events"

    id = Column(String, primary_key=True)
    organizer_id = Column(String, ForeignKey("users.id"), nullable=False)

    # 基本情報
    title = Column(String(200), nullable=False)
    description = Column(String, nullable=False)
    start_at = Column(DateTime, nullable=False)
    end_at = Column(DateTime, nullable=False)

    # 開催情報
    event_type = Column(Enum(EventType), nullable=False)
    location = Column(String, nullable=True)  # オフラインの場合
    online_url = Column(String, nullable=True)  # オンラインの場合

    # 参加設定
    max_participants = Column(Integer, nullable=True)  # Nullなら無制限
    requires_approval = Column(Boolean, default=False)

    # メタデータ
    tags = Column(JSON)
    status = Column(Enum(EventStatus), default=EventStatus.DRAFT)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

    # Relations
    organizer = relationship("User", back_populates="organized_events")
    participants = relationship("EventParticipant", back_populates="event")
    comments = relationship("EventComment", back_populates="event")

class EventParticipant(Base):
    __tablename__ = "event_participants"

    id = Column(String, primary_key=True)
    event_id = Column(String, ForeignKey("events.id"), nullable=False)
    user_id = Column(String, ForeignKey("users.id"), nullable=False)

    status = Column(String)  # "pending", "approved", "attended", "cancelled"
    registered_at = Column(DateTime, default=datetime.utcnow)
    attended_at = Column(DateTime, nullable=True)  # チェックイン時刻

    # Relations
    event = relationship("Event", back_populates="participants")
    user = relationship("User")
```

---

# Part 2: 貢献度ポイント機能

## 1. 機能概要

ユーザーのasotobaseへの貢献（イベント参加、ログ投稿、他者支援など）をポイント化し、可視化する機能。「共存共栄」を体感できる仕組み。

## 2. ポイント付与ルール

### 基本アクション

| アクション | ポイント | 条件・備考 |
|-----------|---------|-----------|
| **アカウント作成** | 50pt | 初回のみ（ウェルカムボーナス） |
| **プロフィール完成** | 20pt | 初回のみ |
| **目標作成** | 5pt | |
| **ステップ完了（小）** | 5pt | 所要時間30分未満 |
| **ステップ完了（中）** | 10pt | 所要時間30分〜1時間 |
| **ステップ完了（大）** | 20pt | 所要時間1時間以上 |
| **目標達成（小）** | 50pt | ステップ3個以下 |
| **目標達成（中）** | 100pt | ステップ4-6個 |
| **目標達成（大）** | 200pt | ステップ7個以上 |

### コミュニティ活動

| アクション | ポイント | 条件・備考 |
|-----------|---------|-----------|
| **イベント参加** | 10pt | チェックイン必須 |
| **イベント主催** | 50pt | 開催完了時 |
| **イベントに5回参加** | +50pt | ボーナス |
| **プロジェクト参加** | 20pt | 参加承認時 |
| **プロジェクト完了** | 100pt | プロジェクト完了時 |

### 内省・学び

| アクション | ポイント | 条件・備考 |
|-----------|---------|-----------|
| **内省ログ投稿** | 5pt | 1日1回まで |
| **長文ログ投稿** | +5pt | 500文字以上 |
| **公開ログ投稿** | +3pt | コミュニティに公開 |
| **AIフィードバック取得** | 0pt | 無料（行動促進） |
| **連続ログイン** | 1pt/日 | |
| **7日連続ログイン** | +10pt | ストリークボーナス |

### 他者支援

| アクション | ポイント | 条件・備考 |
|-----------|---------|-----------|
| **他者のログにコメント** | 3pt | |
| **マッチング成立** | 10pt | 双方に付与 |
| **メンタリング（1回）** | 30pt | 将来実装 |

## 3. レベル・バッジシステム

### レベル

| レベル | 必要ポイント | 称号 |
|--------|-------------|------|
| 1 | 0 - 99 | ビギナー |
| 2 | 100 - 299 | アクティブ |
| 3 | 300 - 599 | コントリビューター |
| 4 | 600 - 999 | リーダー |
| 5 | 1000 - 1999 | マスター |
| 6 | 2000+ | レジェンド |

### バッジ

| バッジ名 | 獲得条件 | アイコン |
|---------|---------|---------|
| はじめの一歩 | 初めての目標作成 | 👣 |
| 継続は力なり | 7日連続ログイン | 🔥 |
| 挑戦者 | 3つの目標を作成 | 🎯 |
| 達成者 | 初めての目標達成 | 🏆 |
| スーパー達成者 | 10個の目標を達成 | 🌟 |
| イベントマスター | 10回イベント参加 | 🎉 |
| コミュニティリーダー | 5回イベント主催 | 👑 |
| 関係性マスター | 関係性スコア90以上 | 🤝 |
| 多動性マスター | 多動性スコア90以上 | 🚀 |
| 感受性マスター | 感受性スコア90以上 | 💭 |
| あそとマスター | 全スコア80以上 | 👑✨ |

## 4. 画面設計

### 4.1 ポイント・バッジ画面（/points）

```
┌─────────────────────────────────────────────────────────┐
│  マイポイント & バッジ                                  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🏆 あなたのレベル                            │        │
│  │                                              │        │
│  │      Lv.3 コントリビューター                 │        │
│  │                                              │        │
│  │  ┌──────────────────────────────┐           │        │
│  │  │ ■■■■■■■■■□□□□□□ 450/600│           │        │
│  │  └──────────────────────────────┘           │        │
│  │                                              │        │
│  │  次のレベルまであと150ポイント               │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 💰 ポイント詳細                              │        │
│  │                                              │        │
│  │  総獲得ポイント:     450 pt                  │        │
│  │  今月の獲得:         80 pt                   │        │
│  │  今週の獲得:         25 pt                   │        │
│  │                                              │        │
│  │  [ポイント履歴を見る]                        │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🎖️ 獲得したバッジ（8個）                     │        │
│  │                                              │        │
│  │  👣 はじめの一歩      🔥 継続は力なり       │        │
│  │  🎯 挑戦者            🏆 達成者             │        │
│  │  🌟 スーパー達成者    🎉 イベントマスター   │        │
│  │  🤝 関係性マスター    🚀 多動性マスター     │        │
│  │                                              │        │
│  │  [すべてのバッジを見る]                      │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 📊 ポイント獲得の内訳（今月）                │        │
│  │                                              │        │
│  │  イベント参加      ■■■■■■ 30pt (38%)   │        │
│  │  ステップ完了      ■■■■ 25pt (31%)       │        │
│  │  ログ投稿          ■■■ 15pt (19%)         │        │
│  │  他者支援          ■■ 10pt (12%)          │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🎯 次に狙えるバッジ                          │        │
│  │                                              │        │
│  │  💭 感受性マスター                           │        │
│  │     条件: 感受性スコア90以上                 │        │
│  │     現在: 78 / 90                            │        │
│  │     [達成のヒント]                           │        │
│  │                                              │        │
│  │  👑 コミュニティリーダー                     │        │
│  │     条件: 5回イベント主催                    │        │
│  │     現在: 2 / 5                              │        │
│  │     [イベントを作成]                         │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

# Part 3: ダッシュボード機能

## 1. 機能概要

ユーザーの活動状況、おすすめアクション、コミュニティ全体の動きを一画面で把握できるメインハブ。

## 2. 画面設計

### メインダッシュボード（/dashboard）

```
┌─────────────────────────────────────────────────────────┐
│  ダッシュボード                                   田中さん│
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────────┐  ┌──────────────────┐           │
│  │ 🎯 あそとスコア   │  │ 🏆 ポイント       │           │
│  │                  │  │                  │           │
│  │      関係性      │  │  Lv.3            │           │
│  │       /\         │  │  450pt           │           │
│  │    85/  \        │  │                  │           │
│  │     /  92 \      │  │  今月: +80pt     │           │
│  │    /      \      │  │                  │           │
│  │ 感受性 ─ 多動性  │  │  [詳細]          │           │
│  │   78       65    │  │                  │           │
│  └──────────────────┘  └──────────────────┘           │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ ✨ 今日のおすすめアクション                  │        │
│  │                                              │        │
│  │  1. 📝 今週の振り返りログを書く              │        │
│  │     所要時間: 10分  獲得: 5pt               │        │
│  │     [書く]                                   │        │
│  │                                              │        │
│  │  2. 🎉 デザイン思考WSに参加する              │        │
│  │     11/22(金) 19:30-  獲得: 10pt            │        │
│  │     マッチ度: 88%                            │        │
│  │     [詳細]                                   │        │
│  │                                              │        │
│  │  3. 🤝 山田さんとつながる                    │        │
│  │     マッチ度: 85%                            │        │
│  │     [プロフィールを見る]                     │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌───────────────┐  ┌───────────────┐               │
│  │ 📋 進行中の目標│  │ 📅 今後のイベント│               │
│  │               │  │               │               │
│  │ 読書会を      │  │ 11/20 (水)   │               │
│  │ 立ち上げる    │  │ 読書会        │               │
│  │ ■■□□ 40%    │  │               │               │
│  │               │  │ 11/22 (金)   │               │
│  │ 副業で月5万   │  │ デザイン思考WS│               │
│  │ 稼ぐ          │  │               │               │
│  │ ■■■□ 60%    │  │ [もっと見る]  │               │
│  │               │  │               │               │
│  │ [すべて見る]  │  │               │               │
│  └───────────────┘  └───────────────┘               │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🌟 コミュニティハイライト                    │        │
│  │                                              │        │
│  │  📢 新しいイベント「あそと新年会」が作成されました│    │
│  │     主催: 鈴木さん  12/28(土) 18:00-        │        │
│  │                                              │        │
│  │  🎉 佐藤さんが「あそとマスター」バッジを獲得！│        │
│  │                                              │        │
│  │  📚 読書会プロジェクトが完了しました         │        │
│  │     5人のメンバーで3ヶ月間活動              │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 📊 コミュニティ統計（今月）                  │        │
│  │                                              │        │
│  │  アクティブメンバー:  127人                  │        │
│  │  開催イベント数:      15回                   │        │
│  │  新しいつながり:      234件                  │        │
│  │  ログ投稿数:          189件                  │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 3. データモデル

```python
# ダッシュボードは既存データの集約なので、新しいモデルは不要
# ただし、キャッシュ用のモデルを作成することも検討

class DashboardCache(Base):
    __tablename__ = "dashboard_cache"

    user_id = Column(String, ForeignKey("users.id"), primary_key=True)

    # キャッシュデータ（JSON）
    recommended_actions = Column(JSON)
    active_goals = Column(JSON)
    upcoming_events = Column(JSON)
    community_highlights = Column(JSON)

    # キャッシュ更新日時
    cached_at = Column(DateTime, default=datetime.utcnow)
```

## 4. APIエンドポイント

```python
@router.get("/api/v1/dashboard")
async def get_dashboard(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """ダッシュボードデータを取得"""

    # 各種データを並列取得
    asoto_scores = await get_asoto_scores(current_user)
    points = await get_user_points(current_user)
    recommended_actions = await get_recommended_actions(current_user)
    active_goals = await get_active_goals(current_user)
    upcoming_events = await get_upcoming_events(current_user)
    community_highlights = await get_community_highlights()

    return {
        "asoto_scores": asoto_scores,
        "points": points,
        "recommended_actions": recommended_actions,
        "active_goals": active_goals,
        "upcoming_events": upcoming_events,
        "community_highlights": community_highlights
    }
```

---

## 5. まとめ

これで主要機能の詳細設計が完成しました！

**完成した機能設計**
1. ✅ あそとステップ管理
2. ✅ 内省ログ
3. ✅ AIコーチング
4. ✅ マッチング
5. ✅ イベント管理
6. ✅ 貢献度ポイント
7. ✅ ダッシュボード

これらの機能が組み合わさることで、asotobaseは**個人の成長とコミュニティの共栄**を実現します。

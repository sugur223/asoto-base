# AIコーチング機能 - 詳細設計

## 1. 機能概要

AIとの対話を通じてユーザーの気づきを深め、行動を促進するパーソナルコーチング機能。単なる情報提供ではなく、ユーザー一人ひとりの成長をサポートする。

## 2. コアコンセプト

### AIコーチの役割

1. **傾聴者**: ユーザーの振り返りを丁寧に読み、共感する
2. **質問者**: 深い気づきを引き出す問いを投げかける
3. **分析者**: 行動パターンを分析し、客観的な視点を提供
4. **提案者**: 次のアクションを具体的に提案
5. **応援者**: 成長を認め、励まし、継続を促す

### 設計思想

- **押し付けない**: 提案はあくまで選択肢として提示
- **パーソナライズ**: ユーザーの履歴や性格に合わせた対応
- **成長重視**: 短期的な成果より長期的な成長を支援
- **透明性**: AIの判断理由を明示

## 3. AIコーチング体験のフロー

### フロー1: ログ投稿時の即座フィードバック

```
[ユーザーがログを投稿]
    ↓
[AIがログを分析（5秒以内）]
    ↓
[フィードバックを生成]
    ↓
[ユーザーに表示]
    ↓
[（任意）ユーザーが追加質問]
    ↓
[AIが対話形式で深掘り]
```

### フロー2: 定期的な振り返りコーチング

```
[週末にシステムが通知]
「今週の振り返りをしましょう」
    ↓
[ユーザーが「始める」をクリック]
    ↓
[AIが今週の活動を要約]
「今週は3つのイベントに参加、2つの
 ステップを完了しましたね」
    ↓
[AIが質問を投げかける]
「今週で最も印象に残ったことは？」
    ↓
[ユーザーが回答]
    ↓
[AIがさらに深掘り]
「それはなぜ印象的でしたか?」
    ↓
[対話を通じて気づきを深める]
```

### フロー3: 目標設定サポート

```
[ユーザーが「目標を作りたいけど
  何をすればいいかわからない」]
    ↓
[AIがヒアリング開始]
「最近興味があることは何ですか？」
    ↓
[ユーザーが回答]
    ↓
[AIが過去の活動履歴も参照]
    ↓
[AIが目標とステップを提案]
「では、こんな目標はどうでしょう？」
    ↓
[ユーザーが採用 or カスタマイズ]
```

## 4. 画面設計

### 4.1 AIコーチングダッシュボード（/coaching）

```
┌─────────────────────────────────────────────────────────┐
│  🤖 AIコーチング                                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  あなた専用のAIコーチ                                   │
│  あそとの成長をサポートします                           │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 💬 今週の振り返りコーチング                  │        │
│  │                                              │        │
│  │  今週も充実した活動でしたね！               │        │
│  │  特に「読書会」への継続的な参加から、       │        │
│  │  関係性スコアが着実に向上しています。       │        │
│  │                                              │        │
│  │  さらに成長するために、いくつか質問を       │        │
│  │  させてください。                            │        │
│  │                                              │        │
│  │  [振り返りを始める]                          │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 📊 あなたの成長レポート                      │        │
│  │                                              │        │
│  │  過去30日間の分析                            │        │
│  │  ・ログ投稿: 12回（先月比 +20%）            │        │
│  │  ・イベント参加: 4回                         │        │
│  │  ・新しいつながり: 8人                       │        │
│  │                                              │        │
│  │  【強み】                                    │        │
│  │  • 継続的な内省の習慣が身についている       │        │
│  │  • 新しい人との出会いに積極的               │        │
│  │                                              │        │
│  │  【伸びしろ】                                │        │
│  │  • プロジェクトへの参加が少ない             │        │
│  │  • 多動性スコアを高める余地あり             │        │
│  │                                              │        │
│  │  [詳細を見る]                                │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 💡 今週のおすすめアクション                  │        │
│  │                                              │        │
│  │  1. 新しいプロジェクトに参加してみる         │        │
│  │     理由: 多動性を高めるチャンス             │        │
│  │     [プロジェクトを探す]                     │        │
│  │                                              │        │
│  │  2. 読書会で知り合った○○さんと1on1する      │        │
│  │     理由: 関係性をさらに深める好機           │        │
│  │     [メッセージを送る]                       │        │
│  │                                              │        │
│  │  3. 今月の目標の進捗を確認する               │        │
│  │     理由: 期限まであと2週間                  │        │
│  │     [目標を見る]                             │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🎯 AIに相談する                              │        │
│  │                                              │        │
│  │  何でも聞いてください：                      │        │
│  │  ・「次にどんな目標を立てればいい？」       │        │
│  │  ・「継続するコツは？」                      │        │
│  │  ・「自分の強みは何？」                      │        │
│  │                                              │        │
│  │  ┌──────────────────────────────┐        │        │
│  │  │ 質問を入力...                  │        │        │
│  │  └──────────────────────────────┘        │        │
│  │  [送信]                                      │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 📜 過去のコーチング履歴                      │        │
│  │                                              │        │
│  │  • 2025-11-10: 週次振り返り                  │        │
│  │  • 2025-11-08: ログへのフィードバック        │        │
│  │  • 2025-11-03: 週次振り返り                  │        │
│  │  • 2025-10-28: 目標設定サポート              │        │
│  │                                              │        │
│  │  [すべて見る]                                │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2 対話型コーチング画面（/coaching/session/:id）

```
┌─────────────────────────────────────────────────────────┐
│  🤖 今週の振り返りコーチング              2025-11-17   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🤖 AI Coach                              │        │
│  │                                              │        │
│  │  こんにちは！今週も1週間お疲れさまでした。  │        │
│  │  まず、今週の活動を振り返ってみましょう。   │        │
│  │                                              │        │
│  │  今週のあなた：                              │        │
│  │  ✅ イベント参加: 3回（読書会、勉強会、交流会）│      │
│  │  ✅ ログ投稿: 2回                            │        │
│  │  ✅ ステップ完了: 2個                        │        │
│  │  ✅ 新しいつながり: 3人                      │        │
│  │                                              │        │
│  │  素晴らしいですね！特にイベント参加が        │        │
│  │  活発です👏                                  │        │
│  │                                              │        │
│  │  では、質問です：                            │        │
│  │  今週で最も印象に残ったことは何ですか？     │        │
│  └────────────────────────────────────────────┘        │
│                                            10:00       │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │                                          👤 │        │
│  │  読書会で田中さんの話を聞いて、「他者の    │        │
│  │  視点を受け入れる」ことの大切さに気づい    │        │
│  │  たことです。                                │        │
│  └────────────────────────────────────────────┘        │
│                                            10:02       │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🤖 AI Coach                              │        │
│  │                                              │        │
│  │  それは素晴らしい気づきですね！              │        │
│  │                                              │        │
│  │  「他者の視点を受け入れる」ことに気づいた   │        │
│  │  きっかけは何だったのでしょうか？           │        │
│  │  田中さんの話の中で、特に心に響いた         │        │
│  │  フレーズや場面はありましたか？             │        │
│  └────────────────────────────────────────────┘        │
│                                            10:02       │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │                                          👤 │        │
│  │  「本の読み方は人それぞれで、正解はない」   │        │
│  │  という言葉です。これまで自分の読み方が     │        │
│  │  正しいと思い込んでいたので、ハッとしました。│        │
│  └────────────────────────────────────────────┘        │
│                                            10:05       │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ 🤖 AI Coach                              │        │
│  │                                              │        │
│  │  なるほど。「思い込み」に気づいた瞬間       │        │
│  │  ですね。                                    │        │
│  │                                              │        │
│  │  この気づきは、読書以外の場面でも           │        │
│  │  活かせそうですか？                          │        │
│  │  例えば、仕事やプライベートで似たような     │        │
│  │  「思い込み」を持っていることはあり         │        │
│  │  ませんか？                                  │        │
│  └────────────────────────────────────────────┘        │
│                                            10:06       │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │ メッセージを入力...                          │        │
│  │                                              │        │
│  │ [送信]                                       │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│  ┌──────────────────────────────────────┐            │
│  │ 💡 関連する提案                        │            │
│  │  • この気づきを内省ログに記録する      │            │
│  │  • 「オープンマインド」をテーマにした  │            │
│  │    目標を作成する                      │            │
│  └──────────────────────────────────────┘            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.3 成長レポート（/coaching/growth-report）

```
┌─────────────────────────────────────────────────────────┐
│  📊 あなたの成長レポート                 過去3ヶ月     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │ 🎯 あそと3要素スコア                     │           │
│  │                                         │           │
│  │           関係性                        │           │
│  │             /\                          │           │
│  │          85/  \                         │           │
│  │           /    \                        │           │
│  │          /  92  \                       │           │
│  │         /        \                      │           │
│  │    感受性 ────── 多動性                 │           │
│  │       78            65                  │           │
│  │                                         │           │
│  │  ── 3ヶ月前  ── 現在                    │           │
│  │                                         │           │
│  │  📈 最も成長: 関係性 (+20pt)            │           │
│  │  💡 伸びしろ: 多動性 (+10pt)            │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │ 💪 あなたの強み                          │           │
│  │                                         │           │
│  │  1. 継続的な内省の習慣                  │           │
│  │     • 週平均3回のログ投稿               │           │
│  │     • 連続投稿記録: 14日                │           │
│  │     • 深い気づきが多い                  │           │
│  │                                         │           │
│  │  2. 積極的なネットワーキング            │           │
│  │     • イベント参加: 月平均5回           │           │
│  │     • 新しいつながり: 3ヶ月で20人       │           │
│  │     • 読書会への継続的な参加            │           │
│  │                                         │           │
│  │  3. オープンマインド                    │           │
│  │     • 他者の意見を積極的に聞く姿勢      │           │
│  │     • 異なる視点を受け入れる柔軟性      │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │ 🌱 成長の伸びしろ                        │           │
│  │                                         │           │
│  │  1. プロジェクトへの参加（多動性）      │           │
│  │     現状: 参加プロジェクト 0件          │           │
│  │     提案: まずは小さなプロジェクトから  │           │
│  │           参加してみましょう            │           │
│  │                                         │           │
│  │  2. アウトプットの量（多動性）          │           │
│  │     現状: インプット中心                │           │
│  │     提案: イベント主催や記事執筆など    │           │
│  │           アウトプットを増やしてみる    │           │
│  │                                         │           │
│  │  3. 長期的な目標設定（多動性）          │           │
│  │     現状: 短期目標が中心                │           │
│  │     提案: 3ヶ月〜半年の中期目標を       │           │
│  │           1つ設定してみる               │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │ 📈 成長の軌跡                            │           │
│  │                                         │           │
│  │  9月: あそと活動を開始                  │           │
│  │    • 初イベント参加                     │           │
│  │    • プロフィール作成                   │           │
│  │                                         │           │
│  │  10月: つながりが増え始める             │           │
│  │    • 読書会に継続参加                   │           │
│  │    • 10人以上と交流                     │           │
│  │    • 内省の習慣化                       │           │
│  │                                         │           │
│  │  11月: 深い気づきの段階へ               │           │
│  │    • 「他者の視点」を意識               │           │
│  │    • 関係性スコア急上昇                 │           │
│  │    • 「あそと」を体感し始める           │           │
│  │                                         │           │
│  │  🎯 次のステージ:                        │           │
│  │     「受け身」から「創造」へ            │           │
│  │     自分でイベントやプロジェクトを      │           │
│  │     立ち上げてみませんか？               │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
│  ┌─────────────────────────────────────────┐           │
│  │ 🎁 おすすめの次のアクション              │           │
│  │                                         │           │
│  │  1. 小規模なイベントを主催してみる      │           │
│  │     難易度: ★★☆☆☆                     │           │
│  │     効果: 多動性 +15pt                  │           │
│  │     [イベントを作成]                    │           │
│  │                                         │           │
│  │  2. プロジェクトに参加する              │           │
│  │     難易度: ★★★☆☆                     │           │
│  │     効果: 多動性 +20pt, 関係性 +10pt    │           │
│  │     [プロジェクトを探す]                │           │
│  │                                         │           │
│  │  3. メンター/メンティー関係を作る       │           │
│  │     難易度: ★★★★☆                     │           │
│  │     効果: 関係性 +25pt, 感受性 +15pt    │           │
│  │     [マッチングを見る]                  │           │
│  └─────────────────────────────────────────┘           │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 5. データモデル

### AICoachingSession（コーチングセッション）

```typescript
interface AICoachingSession {
  id: string;
  userId: string;
  type: 'weekly_review' | 'goal_setting' | 'free_talk' | 'log_feedback';
  status: 'active' | 'completed';
  startedAt: Date;
  completedAt?: Date;

  // 対話履歴
  messages: CoachingMessage[];

  // 分析結果
  insights?: string[];
  recommendations?: string[];

  // Relations
  user: User;
}
```

### CoachingMessage（対話メッセージ）

```typescript
interface CoachingMessage {
  id: string;
  sessionId: string;
  role: 'user' | 'ai';
  content: string;
  timestamp: Date;

  // メタデータ
  sentiment?: 'positive' | 'negative' | 'neutral';
  keyTopics?: string[];

  // Relations
  session: AICoachingSession;
}
```

### GrowthMetrics（成長指標）

```typescript
interface GrowthMetrics {
  id: string;
  userId: string;
  date: Date;

  // あそと3要素スコア（0-100）
  relationshipScore: number;
  activityScore: number;
  sensitivityScore: number;

  // 詳細メトリクス
  eventParticipation: number; // イベント参加数
  logCount: number; // ログ投稿数
  newConnections: number; // 新しいつながり
  projectParticipation: number; // プロジェクト参加数

  // 計算根拠
  calculationDetails: {
    relationship: {
      eventParticipation: number;
      newConnections: number;
      comments: number;
    };
    activity: {
      stepsCompleted: number;
      projectParticipation: number;
      eventHosting: number;
    };
    sensitivity: {
      logFrequency: number;
      logDepth: number;
      reflectionQuality: number;
    };
  };

  // Relations
  user: User;
}
```

## 6. AIプロンプト設計

### 週次振り返りコーチング用プロンプト

```
あなたは「あそと」コミュニティのAIコーチです。
ユーザーの成長を支援する役割を担っています。

【ユーザー情報】
- 名前: {userName}
- 活動期間: {activityDuration}
- あそと3要素スコア:
  - 関係性: {relationshipScore}/100
  - 多動性: {activityScore}/100
  - 感受性: {sensitivityScore}/100

【今週の活動サマリー】
- イベント参加: {eventCount}回
  {eventDetails}
- ログ投稿: {logCount}回
- ステップ完了: {stepCount}個
- 新しいつながり: {newConnectionCount}人

【過去のログ（最新5件）】
{recentLogs}

【コーチングの目的】
1. 今週の活動を振り返り、気づきを深める
2. 成長している点を認識してもらう
3. 次週の具体的なアクションを一緒に考える

【コーチングのスタイル】
- 傾聴的: ユーザーの言葉を丁寧に受け止める
- 質問型: 答えを教えるのではなく、気づきを引き出す質問をする
- 肯定的: 成長を認め、励ます
- 具体的: 抽象的ではなく、具体的なアクションを提案

【禁止事項】
- 上から目線の指示
- ネガティブな批判
- 一般論のみの提供
- 過度な褒め言葉

それでは、温かく親しみやすいトーンで、ユーザーとの対話を始めてください。
```

### ログフィードバック用プロンプト

```
あなたは「あそと」コミュニティのAIコーチです。
ユーザーが投稿したログに対してフィードバックを提供します。

【ユーザー情報】
- 名前: {userName}
- あそと3要素スコア:
  - 関係性: {relationshipScore}/100
  - 多動性: {activityScore}/100
  - 感受性: {sensitivityScore}/100

【投稿されたログ】
タイトル: {logTitle}
本文: {logContent}
タグ: {logTags}

【過去のログ（比較用）】
{recentLogs}

【フィードバックの目的】
1. ログの内容を肯定的に受け止める
2. 気づきのポイントを明確化する
3. さらに深めるための質問を投げかける
4. 次のアクションを提案する
5. （該当する場合）成長パターンを指摘する

【フィードバックの構成】
1. 受容・共感（2-3行）
2. ポイントの明確化（2-3行）
3. 深掘りの質問（1-2個）
4. 次のアクション提案（1-3個）
5. （オプション）成長の指摘

【トーン】
- 温かく、励ましの姿勢
- 具体的で実践的
- 押し付けがましくない

それでは、このログに対するフィードバックを生成してください。
```

### 目標設定サポート用プロンプト

```
あなたは「あそと」コミュニティのAIコーチです。
ユーザーが新しい目標を設定するサポートをします。

【ユーザー情報】
- 名前: {userName}
- あそと3要素スコア:
  - 関係性: {relationshipScore}/100
  - 多動性: {activityScore}/100
  - 感受性: {sensitivityScore}/100
- 過去の目標達成数: {completedGoalsCount}

【過去の活動履歴】
{activityHistory}

【伸びしろ分析】
最もスコアが低い要素: {lowestScore}

【サポートの流れ】
1. 興味・関心のヒアリング
2. 過去の活動との一貫性確認
3. 伸びしろを考慮した目標提案
4. 目標の具体化（ステップ分解）
5. 実現可能性の確認

【提案のポイント】
- ユーザーの興味と成長課題をバランスさせる
- 小さく始められるステップを提案
- 達成感を得やすい難易度
- あそと3要素のバランスを意識

それでは、対話を通じて目標設定をサポートしてください。
```

## 7. スコア計算ロジック

### 関係性スコア（0-100）

```typescript
function calculateRelationshipScore(user: User): number {
  const weights = {
    eventParticipation: 0.3,  // イベント参加頻度
    newConnections: 0.25,      // 新しいつながり
    comments: 0.2,             // コメント・交流
    matching: 0.15,            // マッチング成立数
    eventHosting: 0.1          // イベント主催
  };

  // 各要素を0-100に正規化して加重平均
  const normalized = {
    eventParticipation: normalize(user.eventParticipationLast30Days, 0, 10),
    newConnections: normalize(user.newConnectionsLast30Days, 0, 15),
    comments: normalize(user.commentsLast30Days, 0, 20),
    matching: normalize(user.matchingSuccessLast30Days, 0, 5),
    eventHosting: normalize(user.eventHostingLast30Days, 0, 3)
  };

  return Math.round(
    normalized.eventParticipation * weights.eventParticipation +
    normalized.newConnections * weights.newConnections +
    normalized.comments * weights.comments +
    normalized.matching * weights.matching +
    normalized.eventHosting * weights.eventHosting
  );
}
```

### 多動性スコア（0-100）

```typescript
function calculateActivityScore(user: User): number {
  const weights = {
    stepsCompleted: 0.35,       // ステップ完了数
    projectParticipation: 0.25, // プロジェクト参加
    eventHosting: 0.2,          // イベント主催
    newGoals: 0.1,              // 新しい目標設定
    diversity: 0.1              // 活動の多様性
  };

  const normalized = {
    stepsCompleted: normalize(user.stepsCompletedLast30Days, 0, 15),
    projectParticipation: normalize(user.projectCountLast30Days, 0, 3),
    eventHosting: normalize(user.eventHostingLast30Days, 0, 3),
    newGoals: normalize(user.newGoalsLast30Days, 0, 5),
    diversity: calculateDiversityScore(user) // 異なるカテゴリへの参加
  };

  return Math.round(
    normalized.stepsCompleted * weights.stepsCompleted +
    normalized.projectParticipation * weights.projectParticipation +
    normalized.eventHosting * weights.eventHosting +
    normalized.newGoals * weights.newGoals +
    normalized.diversity * weights.diversity
  );
}
```

### 感受性スコア（0-100）

```typescript
function calculateSensitivityScore(user: User): number {
  const weights = {
    logFrequency: 0.3,          // ログ投稿頻度
    logDepth: 0.3,              // ログの深さ
    reflectionQuality: 0.25,    // 振り返りの質
    aiEngagement: 0.15          // AIコーチングの活用度
  };

  const normalized = {
    logFrequency: normalize(user.logsLast30Days, 0, 12),
    logDepth: calculateLogDepthScore(user), // 文字数、構造化など
    reflectionQuality: calculateReflectionQuality(user), // AI分析
    aiEngagement: normalize(user.aiSessionsLast30Days, 0, 8)
  };

  return Math.round(
    normalized.logFrequency * weights.logFrequency +
    normalized.logDepth * weights.logDepth +
    normalized.reflectionQuality * weights.reflectionQuality +
    normalized.aiEngagement * weights.aiEngagement
  );
}
```

## 8. パーソナライゼーション

### コーチングトーン設定

ユーザーが好みのコーチングスタイルを選択可能：

1. **励まし型**（デフォルト）
   - ポジティブな言葉を多用
   - 「素晴らしい！」「よくできました！」

2. **分析型**
   - データと事実を重視
   - 「過去30日の分析では...」

3. **質問型**
   - 気づきを引き出す質問が中心
   - 「それはなぜだと思いますか？」

4. **淡々型**
   - 感情表現を抑えめ
   - 事実とロジックを淡々と

### 頻度設定

- **積極的**: 週2回の振り返りコーチング
- **標準**: 週1回の振り返りコーチング
- **控えめ**: 月1回または手動起動のみ

## 9. プライバシー・倫理

### データ使用の透明性

- AIが参照するデータを明示
- ユーザーがいつでもデータ使用を停止可能

### 倫理ガイドライン

- メンタルヘルスの問題を検知した場合の対応
- 専門家への相談を促す仕組み
- AIの限界を明示

## 10. 今後の拡張案

### Phase 2
- **音声コーチング**: 音声での対話
- **パーソナリティ診断**: より詳細なパーソナライゼーション
- **グループコーチング**: 複数人での振り返りセッション

### Phase 3
- **予測分析**: ユーザーの行動パターンから未来を予測
- **ピアコーチング**: ユーザー同士のコーチング仲介
- **長期目標トラッキング**: 1年以上の長期的な成長支援
